name: "Test API Dockerfile structure"

on:
  push:
    branches:
      - main
      - milestone4
      - milestone5

jobs:
  dockerfile-test:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the source code
      - name: Checkout source
        uses: actions/checkout@v3

      # Step 2: Build the Docker image
      - name: Build Docker image
        working-directory: src/apiservice
        run: |
          docker build -t test-api-image:latest -f Dockerfile .

      # Step 3: Run Container Structure Tests
      - name: Run Container Structure Tests
        uses: plexsystems/container-structure-test-action@v0.1.0
        with:
          image: test-api-image:latest
          config: src/apiservice/tests/docker_test.yml

      # Step 4: Delete Docker image
      - name: Cleanup Docker image
        run: docker image rm test-api-image:latest || echo "Image not found, skipping cleanup"
